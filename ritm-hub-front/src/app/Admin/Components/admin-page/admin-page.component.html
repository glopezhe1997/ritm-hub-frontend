<section class="min-h-screen bg-[#0a0f1a] flex flex-col items-center py-12">
  <div class="bg-[#1E293B] rounded-xl shadow-lg p-8 w-full max-w-2xl flex flex-col items-center">
    <h2 class="text-3xl font-bold text-[#9810FA] mb-2 text-center">Admin Panel</h2>
    <!--Internal navegation-->
    <nav>
        <ul class="flex space-x-6 mb-6">
            <li>
                <a [routerLink]="[]" fragment="statistics" class="text-gray-300 font-thin hover:text-white">View Reports</a>            </li>
            <li>
                <a [routerLink]="[]" fragment="manage-users" class="text-gray-300 font-thin hover:text-white">Manage Users</a>
            </li>
        </ul>
    </nav>

    <p class="text-gray-300 mb-6 text-center">
      Welcome to the admin panel. Here you can manage users, settings, and view reports.
    </p>

    <section class="w-full" id="statistics">
      <h3 class="text-xl font-semibold text-[#9810FA] mb-4 text-center">Statistics</h3>
      <div class="flex flex-col items-center">
        <!-- Gráfico de usuarios activos/inactivos -->
        <div style="max-width: 350px; margin: 0 auto;" class="bg-[#101828] rounded-lg p-4 shadow mb-6">
          <canvas
            baseChart
            [data]="userChartData"
            [options]="userChartOptions"
            [type]="'bar'"
            [width]="350"
            [height]="200">
          </canvas>
        </div>
        <!-- Gráfico de playlists públicas/privadas -->
        <div style="max-width: 350px; margin: 10px auto;" class="bg-[#101828] rounded-lg p-4 shadow mb-6">
          <canvas
            baseChart
            [data]="playlistChartData"
            [options]="playlistChartOptions"
            [type]="'bar'"
            [width]="350"
            [height]="200">
          </canvas>
        </div>
        <!-- Solo cards de totales -->
        <div class="grid grid-cols-2 gap-4 mt-6 w-full">
          <app-card-statistics
            [title]="'Total Users'"
            [value]="dataStatistics?.totalUsers ?? 0"
          ></app-card-statistics>
          <app-card-statistics
            [title]="'Total Playlists'"
            [value]="dataStatistics?.totalPlaylists ?? 0"
          ></app-card-statistics>
        </div>
      </div>
    </section>
  
    <section id="manage-users" class="mt-6 w-full">
      <h3 class="text-xl font-semibold text-[#9810FA] mb-4 text-center">
        Manage Users
      </h3>

      <div class="flex justify-center">
        <app-search-bar
          placeholder="Search users..."
          (search)="onSearchUsers($event)">
        </app-search-bar>
      </div>
     <ng-container *ngIf="users$ | async as users">
        <ul class="mt-4">
          <li *ngFor="let user of users" class="bg-[#101828] rounded-lg p-4 shadow mb-4">
            <div class="mb-2 flex justify-between">
              <h4 class="text-lg font-semibold text-white">{{ user.username }}</h4>
              <p class="text-gray-300">Email: {{ user.email }}</p>
            </div>
            <div class="mb-4 flex flex-wrap justify-between">
              <p [ngClass]="user.isActive ? 'text-green-400' : 'text-red-400'">
                <strong>Active</strong>: {{ user.isActive ? 'Active' : 'Inactive' }}
              </p>
              <p [ngClass]="user.isBlocked ? 'text-red-400' : 'text-green-400'">
                <strong>Blocked</strong>: {{ user.isBlocked ? 'Blocked': 'Unblocked' }}
              </p>
              <p class="text-gray-300 font-thin">
                <strong>Role</strong>:
                <select
                  #roleSelect
                  class="bg-[#1E293B] text-white border border-gray-600 rounded px-2 py-1 ml-2"
                  [value]="user.role"
                  (change)="onChangeUserRole(user, roleSelect.value)">
                  <option value="user">user</option>
                  <option value="admin">admin</option>
                </select>
              </p>
            </div>
            <div class="flex justify-between">
              <button
                (click)="onToggleUserStatus(user)"
                [ngClass]="user.isActive ? 'bg-blue-600 hover:bg-blue-700' : 'bg-gray-600 hover:bg-gray-700'"
                class="text-white font-semibold py-2 px-4 rounded mr-2 disabled:opacity-50 disabled:cursor-not-allowed"
                [disabled]="user.role === 'admin'">
                {{ user.isActive ? 'Deactivate' : 'Activate' }}
              </button>
              <button
                (click)="onToggleUserBlock(user)"
                [ngClass]="user.isBlocked ? 'bg-green-600 hover:bg-green-700' : 'bg-red-600 hover:bg-red-700'"
                class="text-white font-semibold py-2 px-4 rounded mr-2 disabled:opacity-50 disabled:cursor-not-allowed"
                [disabled]="user.role === 'admin'">
                {{ user.isBlocked ? 'Unblock' : 'Block' }}
              </button>
            </div>
          </li>
        </ul>
      </ng-container>
    </section>
  </div>
</section>