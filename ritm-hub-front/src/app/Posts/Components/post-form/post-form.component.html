<div class="w-full min-h-screen p-24 flex items-center justify-center bg-[#0a0f1a]">
  <form
    [formGroup]="postForm"
    (ngSubmit)="savePost()"
    class="w-full max-w-md mx-auto p-8 bg-[#101828] rounded-xl flex flex-col gap-6 shadow-lg"
  >
    <h2 class="text-3xl text-white font-bold mb-6 text-center">
      {{ isUpdateMode ? 'Edit Post' : 'Create Post' }}
    </h2>

    <div>
      <label class="block mb-2 text-[#9810FA] font-semibold">Title:</label>
      <input
        type="text"
        formControlName="title"
        placeholder="Post title..."
        required
        class="bg-[#1E2939] rounded-xl py-1 px-3 text-white border border-gray-600 focus:outline-none focus:border-[#9810FA] w-full"
      />
      <div *ngIf="title.invalid && (title.dirty || title.touched)" class="text-red-500 mt-1 text-sm">
        <span *ngIf="title.errors?.['required']">Title is required.</span>
        <span *ngIf="title.errors?.['minlength']">Minimum 3 characters.</span>
        <span *ngIf="title.errors?.['maxlength']">Maximum 100 characters.</span>
      </div>
    </div>

    <div>
      <label class="block mb-2 text-[#9810FA] font-semibold">Content:</label>
      <textarea
        formControlName="content"
        placeholder="What's on your mind?"
        rows="4"
        required
        class="bg-[#1E2939] rounded-xl py-1 px-3 text-white border border-gray-600 focus:outline-none focus:border-[#9810FA] w-full"
      ></textarea>
      <div *ngIf="content.invalid && (content.dirty || content.touched)" class="text-red-500 mt-1 text-sm">
        <span *ngIf="content.errors?.['required']">Content is required.</span>
        <span *ngIf="content.errors?.['maxlength']">Maximum 500 characters.</span>
      </div>
    </div>

    <div>
      <label class="block mb-2 text-[#9810FA] font-semibold">Mood:</label>
      <select
        formControlName="status"
        required
        class="bg-[#1E2939] rounded-xl py-1 px-3 text-white border border-gray-600 focus:outline-none focus:border-[#9810FA] w-full"
      >
        <option *ngFor="let mood of postStatusOptions" [value]="mood">
          {{ mood | titlecase }}
        </option>
      </select>
    </div>

    <!-- Si quieres permitir seleccionar un track, añade aquí tu selector de tracks -->
    <!-- <app-track-selector formControlName="track"></app-track-selector> -->

    <div *ngIf="!post?.track">
      <app-search-bar (search)="onSearchTracks($event)"></app-search-bar>
      <div *ngIf="searchResults.length && !track.value" class="w-full mt-4">
        <h4 class="text-[#9810FA] mb-2">Spotify Results</h4>
        <ul class="divide-y divide-[#9810FA]/10">
          <li *ngFor="let track of searchResults" class="py-2 flex items-center gap-3">
            <img
              [src]="track.album?.images?.[1]?.url || track.album?.images?.[0]?.url || 'assets/icons/music.png'"
              alt="Album Art"
              class="w-10 h-10 object-cover rounded"
            />
            <span class="flex-1 text-gray-200">{{ track.name }}</span>
            <span class="text-xs text-gray-400">
              {{ track.artists?.[0]?.name || track.artist }}
            </span>
            <button 
              type="button"
              class="ml-2 px-2 py-1 bg-[#9810FA] text-white rounded hover:bg-[#7a0fc2] transition"
              (click)="addTrackToPost(track)"
            >
              <img src="assets/icons/playlists-icon.png" alt="Add Icon" class="w-4 h-4 invert" />
            </button>
          </li>
        </ul>
      </div>
    </div>
    <div *ngIf="track.value" class="mt-4 p-4 bg-[#1E2939] rounded-lg flex items-center justify-between">
      <span class="flex-1 text-gray-200">{{ track.value.name }}</span>
      <span class="text-xs text-gray-400">{{  track.value.duration_ms ?? 0 | timeConversion}}</span>
      <a *ngIf="post?.track?.preview_url" [href]=" track.value.preview_url" target="_blank" class="ml-2">
        <img src="assets/icons/play.png" alt="preview" class="w-5 h-5 invert" />
      </a>
    </div>
    <button
      type="submit"
      [disabled]="postForm.invalid"
      class="w-full py-2 rounded-lg bg-[#9810FA] text-white font-bold hover:bg-[#7a0fc2] transition"
    >
      {{ isUpdateMode ? 'Update Post' : 'Create Post' }}
    </button>
  </form>
</div>